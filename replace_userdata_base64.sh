USER_DATA=`base64 user_data_script.sh -w0`
sed -i '' "s|base64_encoded_bash_script|IyEvYmluL2Jhc2gKIyBHZXQgaW5zdGFuY2UgSUQsIEluc3RhbmNlIEFaLCBWb2x1bWUgSUQgYW5kIFZvbHVtZSBBWiAKSU5TVEFOQ0VfSUQ9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9pbnN0YW5jZS1pZCkKSU5TVEFOQ0VfQVo9JChjdXJsIC1zIGh0dHA6Ly8xNjkuMjU0LjE2OS4yNTQvbGF0ZXN0L21ldGEtZGF0YS9wbGFjZW1lbnQvYXZhaWxhYmlsaXR5LXpvbmUpCkFXU19SRUdJT049dXMtd2VzdC0yCgpWT0xVTUVfSUQ9JChhd3MgZWMyIGRlc2NyaWJlLXZvbHVtZXMgLS1yZWdpb24gJEFXU19SRUdJT04gLS1maWx0ZXIgIk5hbWU9dGFnOk5hbWUsVmFsdWVzPURMLWRhdGFzZXRzLWNoZWNrcG9pbnRzIiAtLXF1ZXJ5ICJWb2x1bWVzW10uVm9sdW1lSWQiIC0tb3V0cHV0IHRleHQpClZPTFVNRV9BWj0kKGF3cyBlYzIgZGVzY3JpYmUtdm9sdW1lcyAtLXJlZ2lvbiAkQVdTX1JFR0lPTiAtLWZpbHRlciAiTmFtZT10YWc6TmFtZSxWYWx1ZXM9REwtZGF0YXNldHMtY2hlY2twb2ludHMiIC0tcXVlcnkgIlZvbHVtZXNbXS5BdmFpbGFiaWxpdHlab25lIiAtLW91dHB1dCB0ZXh0KQoKIyBQcm9jZWVkIGlmIFZvbHVtZSBJZCBpcyBub3QgbnVsbCBvciB1bnNldAppZiBbICRWT0xVTUVfSUQgXTsgdGhlbgoJCSMgQ2hlY2sgaWYgdGhlIFZvbHVtZSBBWiBhbmQgdGhlIGluc3RhbmNlIEFaIGFyZSBzYW1lIG9yIGRpZmZlcmVudC4KCQkjIElmIHRoZXkgYXJlIGRpZmZlcmVudCwgY3JlYXRlIGEgc25hcHNob3QgYW5kIHRoZW4gY3JlYXRlIGEgbmV3IHZvbHVtZSBpbiB0aGUgaW5zdGFuY2UncyBBWi4KCQlpZiBbICRWT0xVTUVfQVogIT0gJElOU1RBTkNFX0FaIF07IHRoZW4KCQkJCVNOQVBTSE9UX0lEPSQoYXdzIGVjMiBjcmVhdGUtc25hcHNob3QgXAoJCQkJCQktLXJlZ2lvbiAkQVdTX1JFR0lPTiBcCgkJCQkJCS0tdm9sdW1lLWlkICRWT0xVTUVfSUQgXAoJCQkJCQktLWRlc2NyaXB0aW9uICJgZGF0ZSArIiVEICVUImAiIFwKCQkJCQkJLS10YWctc3BlY2lmaWNhdGlvbnMgJ1Jlc291cmNlVHlwZT1zbmFwc2hvdCxUYWdzPVt7S2V5PU5hbWUsVmFsdWU9REwtZGF0YXNldHMtY2hlY2twb2ludHMtc25hcHNob3R9XScgXAoJCQkJCQktLXF1ZXJ5IFNuYXBzaG90SWQgLS1vdXRwdXQgdGV4dCkKCgkJCQlhd3MgZWMyIHdhaXQgLS1yZWdpb24gJEFXU19SRUdJT04gc25hcHNob3QtY29tcGxldGVkIC0tc25hcHNob3QtaWRzICRTTkFQU0hPVF9JRAoJCQkJYXdzIGVjMiAtLXJlZ2lvbiAkQVdTX1JFR0lPTiAgZGVsZXRlLXZvbHVtZSAtLXZvbHVtZS1pZCAkVk9MVU1FX0lECgoJCQkJVk9MVU1FX0lEPSQoYXdzIGVjMiBjcmVhdGUtdm9sdW1lIFwKCQkJCQkJLS1yZWdpb24gJEFXU19SRUdJT04gXAoJCQkJCQkJCS0tYXZhaWxhYmlsaXR5LXpvbmUgJElOU1RBTkNFX0FaIFwKCQkJCQkJCQktLXNuYXBzaG90LWlkICRTTkFQU0hPVF9JRCBcCgkJCQkJCS0tdm9sdW1lLXR5cGUgZ3AyIFwKCQkJCQkJLS10YWctc3BlY2lmaWNhdGlvbnMgJ1Jlc291cmNlVHlwZT12b2x1bWUsVGFncz1be0tleT1OYW1lLFZhbHVlPURMLWRhdGFzZXRzLWNoZWNrcG9pbnRzfV0nIFwKCQkJCQkJLS1xdWVyeSBWb2x1bWVJZCAtLW91dHB1dCB0ZXh0KQoJCQkJYXdzIGVjMiB3YWl0IHZvbHVtZS1hdmFpbGFibGUgLS1yZWdpb24gJEFXU19SRUdJT04gLS12b2x1bWUtaWQgJFZPTFVNRV9JRAoJCWZpCgkJIyBBdHRhY2ggdm9sdW1lIHRvIGluc3RhbmNlCgkJYXdzIGVjMiBhdHRhY2gtdm9sdW1lIFwKCQkJLS1yZWdpb24gJEFXU19SRUdJT04gLS12b2x1bWUtaWQgJFZPTFVNRV9JRCBcCgkJCS0taW5zdGFuY2UtaWQgJElOU1RBTkNFX0lEIC0tZGV2aWNlIC9kZXYvc2RmCgkJc2xlZXAgMTAKCgkJIyBNb3VudCB2b2x1bWUgYW5kIGNoYW5nZSBvd25lcnNoaXAsIHNpbmNlIHRoaXMgc2NyaXB0IGlzIHJ1biBhcyByb290CgkJbWtkaXIgL2RsdHJhaW5pbmcKCQltb3VudCAvZGV2L3h2ZGYgL2RsdHJhaW5pbmcKCQljaG93biAtUiBlYzItdXNlcjogL2RsdHJhaW5pbmcvCgkJY2QgL2hvbWUvZWMyLXVzZXIvCgoJCSMgR2V0IHRyYWluaW5nIGNvZGUKCQlnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL2F3c2xhYnMvZWMyLXNwb3QtbGFicy5naXQKCQljaG93biAtUiB1YnVudHU6IGVjMi1zcG90LWxhYnMKCQljZCBlYzItc3BvdC1sYWJzL2VjMi1zcG90LWRlZXAtbGVhcm5pbmctdHJhaW5pbmcvCgoJCSMgSW5pdGlhdGUgdHJhaW5pbmcgdXNpbmcgdGhlIHRlbnNvcmZsb3dfMzYgY29uZGEgZW52aXJvbm1lbnQKCQlzdWRvIC1IIC11IGVjMi11c2VyIGJhc2ggLWMgInNvdXJjZSAvaG9tZS9lYzItdXNlci9hbmFjb25kYTMvYmluL2FjdGl2YXRlIHRlbnNvcmZsb3dfcDM2OyBweXRob24gZWMyX3Nwb3Rfa2VyYXNfdHJhaW5pbmcucHkiCmZpCgojIEFmdGVyIHRyYWluaW5nLCBjbGVhbiB1cCBieSBjYW5jZWxsaW5nIHNwb3QgcmVxdWVzdHMgYW5kIHRlcm1pbmF0aW5nIGl0c2VsZgpTUE9UX0ZMRUVUX1JFUVVFU1RfSUQ9JChhd3MgZWMyIGRlc2NyaWJlLXNwb3QtaW5zdGFuY2UtcmVxdWVzdHMgLS1yZWdpb24gJEFXU19SRUdJT04gLS1maWx0ZXIgIk5hbWU9aW5zdGFuY2UtaWQsVmFsdWVzPSckSU5TVEFOQ0VfSUQnIiAtLXF1ZXJ5ICJTcG90SW5zdGFuY2VSZXF1ZXN0c1tdLlRhZ3NbP0tleT09J2F3czplYzJzcG90OmZsZWV0LXJlcXVlc3QtaWQnXS5WYWx1ZVtdIiAtLW91dHB1dCB0ZXh0KQphd3MgZWMyIGNhbmNlbC1zcG90LWZsZWV0LXJlcXVlc3RzIC0tcmVnaW9uICRBV1NfUkVHSU9OIC0tc3BvdC1mbGVldC1yZXF1ZXN0LWlkcyAkU1BPVF9GTEVFVF9SRVFVRVNUX0lEIC0tdGVybWluYXRlLWluc3RhbmNlcwo=|g" $1
